<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Route Planner</title>
    <style>
      html, body {
        margin: 0;
        padding: 0;
        height: 100%;
        width: 100%;
        font-family: Segoe UI, sans-serif;
      }
      #panel {
        display: flex;
        flex-direction: column;
        height: 100%;
      }
      #controls {
        padding: 8px;
        background: #f9f9f9;
        border-bottom: 1px solid #ccc;
      }
      #map {
        flex: 1;
      }
      #total {
        background: #fafafa;
        border-top: 1px solid #ccc;
        padding: 8px;
        font-size: 15px;
      }
      input, button {
        padding: 6px 10px;
        margin: 4px;
      }
      button {
        cursor: pointer;
      }
    </style>
  </head>
  <body>
    <div id="panel">
      <div id="controls">
        <input id="origin" type="text" placeholder="Origin" style="width: 180px" />
        <input id="destination" type="text" placeholder="Destination" style="width: 180px" />
        <button id="addStop">+ Add Drop</button>
        <button id="calcRoute">Show Route</button>
      </div>
      <div id="map"></div>
      <div id="total">
        <b>Total Distance:</b> <span id="distance">0</span> miles<br>
        <b>Rate per Mile:</b> <input id="rate" type="number" value="2.5" style="width:70px"> 
        <b>Total:</b> <span id="totalRate">0</span> USD / <span id="totalCAD">0</span> CAD
      </div>
    </div>

    <script>
      let map, directionsService, directionsRenderer;
      let waypoints = [];

      function initMap() {
        map = new google.maps.Map(document.getElementById("map"), {
          center: { lat: 43.6532, lng: -79.3832 },
          zoom: 5,
        });
        directionsService = new google.maps.DirectionsService();
        directionsRenderer = new google.maps.DirectionsRenderer({
          map: map,
          draggable: true,
        });
        directionsRenderer.addListener("directions_changed", computeDistance);
      }

      document.getElementById("addStop").addEventListener("click", () => {
        const stop = prompt("Enter stop location:");
        if (stop) waypoints.push({ location: stop, stopover: true });
      });

      document.getElementById("calcRoute").addEventListener("click", () => {
        const origin = document.getElementById("origin").value;
        const destination = document.getElementById("destination").value;
        if (!origin || !destination) return alert("Please enter origin and destination");

        directionsService.route(
          {
            origin: origin,
            destination: destination,
            waypoints: waypoints,
            optimizeWaypoints: true,
            travelMode: google.maps.TravelMode.DRIVING,
          },
          (response, status) => {
            if (status === "OK") {
              directionsRenderer.setDirections(response);
              computeDistance();
            } else {
              alert("Route failed: " + status);
            }
          }
        );
      });

      function computeDistance() {
        const directions = directionsRenderer.getDirections();
        let total = 0;
        const route = directions.routes[0];
        route.legs.forEach((leg) => {
          total += leg.distance.value;
        });
        total = total / 1609.34; // meters to miles
        document.getElementById("distance").textContent = total.toFixed(2);

        const rate = parseFloat(document.getElementById("rate").value);
        const totalUSD = (total * rate).toFixed(2);
        const totalCAD = (totalUSD * 1.37).toFixed(2); // Example conversion
        document.getElementById("totalRate").textContent = totalUSD;
        document.getElementById("totalCAD").textContent = totalCAD;
      }
    </script>

    <script
      async
      src="https://maps.googleapis.com/maps/api/js?key=AIzaSyChYFu82xWcUOpUS23eSbuMPgGm7swXuSo&callback=initMap"
    ></script>
  </body>
</html>
